import pandas as pd
import matplotlib.pyplot as plt
from sklearn.metrics import mean_squared_error, accuracy_score
import numpy as np

# Read data from CSV file
file_path = r'C:\Users\DELL\Downloads\simulated_data_final.csv'
df = pd.read_csv(file_path)
df['Date'] = pd.to_datetime(df['Date'])
df.set_index('Date', inplace=True)

# Calculate 10-day and 50-day EMAs
short_window = 10
long_window = 50
df['Short_EMA'] = df['Price'].ewm(span=short_window, adjust=False).mean()
df['Long_EMA'] = df['Price'].ewm(span=long_window, adjust=False).mean()

# Calculate Mean Squared Error (MSE) and Root Mean Squared Error (RMSE)
mse_short_ema = mean_squared_error(df['Price'], df['Short_EMA'])
rmse_short_ema = np.sqrt(mse_short_ema)

mse_long_ema = mean_squared_error(df['Price'], df['Long_EMA'])
rmse_long_ema = np.sqrt(mse_long_ema)

print(f"Mean Squared Error (Short EMA): {mse_short_ema}")
print(f"Mean Squared Error (Long EMA): {mse_long_ema}")
print(f"Root Mean Squared Error (Short EMA): {rmse_short_ema}")
print(f"Root Mean Squared Error (Long EMA): {rmse_long_ema}")

# Calculate Mean Absolute Error (MAE)
mae_short_ema = np.mean(np.abs(df['Price'] - df['Short_EMA']))
mae_long_ema = np.mean(np.abs(df['Price'] - df['Long_EMA']))

print(f"Mean Absolute Error (Short EMA): {mae_short_ema}")
print(f"Mean Absolute Error (Long EMA): {mae_long_ema}")

# Calculate R-squared (R^2)
r_squared_short_ema = 1 - (np.sum((df['Price'] - df['Short_EMA'])**2) / np.sum((df['Price'] - np.mean(df['Price']))**2))
r_squared_long_ema = 1 - (np.sum((df['Price'] - df['Long_EMA'])**2) / np.sum((df['Price'] - np.mean(df['Price']))**2))

print(f"R-squared (Short EMA): {r_squared_short_ema}")
print(f"R-squared (Long EMA): {r_squared_long_ema}")

# Calculate Mean Absolute Percentage Error (MAPE)
mape_short_ema = np.mean(np.abs((df['Price'] - df['Short_EMA']) / df['Price'])) * 100
mape_long_ema = np.mean(np.abs((df['Price'] - df['Long_EMA']) / df['Price'])) * 100

print(f"MAPE (Short EMA): {mape_short_ema:.2f}%")
print(f"MAPE (Long EMA): {mape_long_ema:.2f}%")

# Calculate accuracy of buy/sell signals
buy_signals_actual = df['Price'] < df['Short_EMA']
buy_signals_predicted = df['Short_EMA'] > df['Long_EMA']
accuracy_buy_signals = accuracy_score(buy_signals_actual, buy_signals_predicted)

sell_signals_actual = df['Price'] > df['Short_EMA']
sell_signals_predicted = df['Short_EMA'] < df['Long_EMA']
accuracy_sell_signals = accuracy_score(sell_signals_actual, sell_signals_predicted)

print(f"Accuracy of Buy Signals: {accuracy_buy_signals}")
print(f"Accuracy of Sell Signals: {accuracy_sell_signals}")

# Plotting
plt.figure(figsize=(12, 6))
plt.plot(df.index, df['Price'], label='Stock Price')
plt.plot(df.index, df['Short_EMA'], label=f'Short EMA ({short_window} days)')
plt.plot(df.index, df['Long_EMA'], label=f'Long EMA ({long_window} days)')

# Plotting crossovers
buy_signals = df[df['Short_EMA'] > df['Long_EMA']]
sell_signals = df[df['Short_EMA'] < df['Long_EMA']]

plt.scatter(buy_signals.index, buy_signals['Short_EMA'], marker='^', color='g', label='Buy Signal')
plt.scatter(sell_signals.index, sell_signals['Short_EMA'], marker='v', color='r', label='Sell Signal')

plt.title('Simulated Stock Price and Exponential Moving Averages')
plt.xlabel('Date')
plt.ylabel('Stock Price')
plt.legend()
plt.show()


# Generate sample data
np.random.seed(42)
dates = pd.date_range(start='2022-01-01', end='2022-12-31')
actual_prices = np.random.normal(loc=100, scale=10, size=len(dates))
predicted_prices = np.random.normal(loc=105, scale=8, size=len(dates))

# Create DataFrame
df = pd.DataFrame({'Date': dates, 'Actual_Price': actual_prices, 'Predicted_Price': predicted_prices})
df.set_index('Date', inplace=True)

# Calculate Exponential Moving Averages
short_window = 10
long_window = 50
df['Short_EMA_Actual'] = df['Actual_Price'].ewm(span=short_window, adjust=False).mean()
df['Long_EMA_Actual'] = df['Actual_Price'].ewm(span=long_window, adjust=False).mean()

#df['Short_EMA_Predicted'] = df['Predicted_Price'].ewm(span=short_window, adjust=False).mean()
#df['Long_EMA_Predicted'] = df['Predicted_Price'].ewm(span=long_window, adjust=False).mean()

# Plotting Short EMA
plt.figure(figsize=(12, 6))
plt.plot(df.index, df['Actual_Price'], label='Actual Price')
plt.plot(df.index, df['Predicted_Price'], label='Predicted Price')
#plt.plot(df.index, df['Short_EMA_Actual'], label=f'Short EMA Actual ({short_window} days)')
#plt.plot(df.index, df['Short_EMA_Predicted'], label=f'Short EMA Predicted ({short_window} days)')

plt.title('Actual vs. Predicted Prices and Short Exponential Moving Averages for Simulated Stock Prices')
plt.xlabel('Date')
plt.ylabel('Price')
plt.legend()
plt.show()

# Plotting Long EMA
plt.figure(figsize=(12, 6))
plt.plot(df.index, df['Actual_Price'], label='Actual Price')
plt.plot(df.index, df['Predicted_Price'], label='Predicted Price')
#plt.plot(df.index, df['Long_EMA_Actual'], label=f'Long EMA Actual ({long_window} days)')
#plt.plot(df.index, df['Long_EMA_Predicted'], label=f'Long EMA Predicted ({long_window} days)')

plt.title('Actual vs. Predicted Prices and Long Exponential Moving Averagesfor Simulated Stock Prices')
plt.xlabel('Date')
plt.ylabel('Price')
plt.legend()
plt.show()

from sklearn.metrics import accuracy_score, precision_score, recall_score, f1_score

# Function to generate EMA signals
def generate_ema_signals(data, short_window, long_window):
    signals = pd.DataFrame(index=data.index)
    signals['Signal'] = 0  # 0: No signal, 1: Buy signal, -1: Sell signal
    
    # Calculate EMAs
    data['Short_EMA'] = data['Price'].ewm(span=short_window, adjust=False).mean()
    data['Long_EMA'] = data['Price'].ewm(span=long_window, adjust=False).mean()
    
    # Generate buy/sell signals
    signals['Signal'] = np.where(data['Short_EMA'] > data['Long_EMA'], 1, 0)
    signals['Signal'] = np.where(data['Short_EMA'] < data['Long_EMA'], -1, signals['Signal'])
    
    return signals

# Function to evaluate EMA signals
def evaluate_signals(actual_moves, predicted_moves):
    accuracy = accuracy_score(actual_moves, predicted_moves)
    precision = precision_score(actual_moves, predicted_moves, average='weighted')
    recall = recall_score(actual_moves, predicted_moves, average='weighted')
    f1 = f1_score(actual_moves, predicted_moves, average='weighted')
    
    return accuracy, precision, recall, f1

# Generate simulated data
np.random.seed(42)
dates = pd.date_range(start='2022-01-01', end='2022-12-31')
actual_prices = np.random.normal(loc=100, scale=10, size=len(dates))
simulated_data = pd.DataFrame({'Date': dates, 'Price': actual_prices})
simulated_data.set_index('Date', inplace=True)

# Parameters for EMA calculation
short_window = 10
long_window = 50

# Generate EMA signals for simulated data
ema_signals_simulated = generate_ema_signals(simulated_data, short_window, long_window)

# Evaluate EMA signals for simulated data
actual_moves_simulated = np.where(simulated_data['Price'].shift(-1) > simulated_data['Price'], 1, 0)  # 1: Price will go up, 0: Price will go down
accuracy_simulated, precision_simulated, recall_simulated, f1_simulated = evaluate_signals(actual_moves_simulated, ema_signals_simulated['Signal'])

print("Performance Metrics for EMA signals (Simulated Data):")
print(f"Accuracy: {accuracy_simulated:.2f}")
print(f"Precision: {precision_simulated:.2f}")
print(f"Recall: {recall_simulated:.2f}")
print(f"F1-score: {f1_simulated:.2f}")

# Visualize EMA signals for simulated data
plt.figure(figsize=(12, 6))
plt.plot(simulated_data.index, simulated_data['Price'], label='Simulated Price')
plt.plot(simulated_data.index, simulated_data['Short_EMA'], label=f'Short EMA ({short_window} days)')
plt.plot(simulated_data.index, simulated_data['Long_EMA'], label=f'Long EMA ({long_window} days)')
plt.scatter(ema_signals_simulated.index, simulated_data.loc[ema_signals_simulated.index]['Price'], c=ema_signals_simulated['Signal'], cmap='viridis', label='EMA Signals')
plt.title('Simulated Stock Price and Exponential Moving Averages with Signals')
plt.xlabel('Date')
plt.ylabel('Stock Price')
plt.legend()
plt.show()
